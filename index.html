<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>HOT play</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth-compat.js"></script>
    <style>
        :root { --red: #ff0055; --bg: #000000; --sidebar-width: 70px; --sidebar-expanded: 220px; }
        * { -webkit-tap-highlight-color: transparent !important; outline: none !important; }
        
        body { 
            background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; 
            margin: 0; padding: 0; width: 100vw; height: 100vh; 
            overflow: hidden; display: flex; position: fixed; inset: 0;
        }
        *:focus { outline: none; }
        
        .sidebar { 
            width: var(--sidebar-width); background: #000; 
            display: flex; flex-direction: column; padding: 15px 5px; 
            border-left: 1px solid #222; height: 100%; z-index: 1000; 
            transition: width 0.3s ease; flex-shrink: 0; 
            overflow: hidden; white-space: nowrap;
        }
        .sidebar:focus-within, .sidebar:hover { width: var(--sidebar-expanded); }
        .logo { width: 100%; height: 60px; background: url('./images/logo.png') no-repeat center/contain; margin: 20px 0; }
        
        .nav-item { padding: 12px; font-size: 16px; border-radius: 8px; margin-bottom: 5px; cursor: pointer; display: flex; align-items: center; color: #888; transition: 0.2s; }
        .nav-item:focus { background: var(--red); color: white; transform: scale(1.05); }

        .main-content { flex: 1; height: 100vh; display: flex; flex-direction: column; position: relative; background: #000; overflow: hidden; }
        .top-section { height: 55%; width: 100%; position: relative; flex-shrink: 0; }
        .hero-bg { position: absolute; inset: 0; background-size: cover; background-position: top center; transition: 0.4s; }
        .hero-bg::after { content: ''; position: absolute; inset: 0; background: linear-gradient(to top, #000 5%, rgba(0,0,0,0.6) 50%, transparent 100%); }
        
        .bottom-section { height: 45%; flex-grow: 1; overflow-y: auto; padding-bottom: 100px; scroll-behavior: smooth; }
        .bottom-section::-webkit-scrollbar { display: none; }

        .card { display: inline-block; position: relative; cursor: pointer; border-radius: 6px; overflow: hidden; border: 2px solid transparent; transition: 0.2s; flex-shrink: 0; }
        .card:focus { transform: scale(1.15); z-index: 100; border-color: #fff; outline: none; }
        .card img { width: 100%; height: 100%; object-fit: cover; }

        #video-container { position: fixed; inset: 0; background: #000; z-index: 50000; display: none; }
        
        /* ה-Loading עם הטריק של ה-pointer-events */
        #loader-overlay { position: fixed; inset: 0; background: #000; z-index: 50001; display: none; align-items: center; justify-content: center; pointer-events: none; }
        #loader-overlay video { width: 300px; height: 300px; }

        .login-btn { background: var(--red); color: white; border: none; padding: 12px 40px; font-size: 20px; font-weight: bold; border-radius: 50px; margin-top: 20px; cursor: pointer; }
        .login-btn:focus { transform: scale(1.1); outline: 3px solid white !important; }
    </style>
</head>
<body>
    <div id="loading-screen" style="position:fixed; inset:0; background:#000; z-index:99999; display:flex; align-items:center; justify-content:center;"><h1>טוען...</h1></div>
    <div id="loader-overlay"><video src="loading.mp4" autoplay loop muted playsinline></video></div>

    <div id="auth-screen" style="display:none; position:fixed; inset:0; background:#000; flex-direction:column; align-items:center; justify-content:center; z-index:10000;">
        <h1 style="font-size: 60px; color: var(--red); margin: 0;">HOT Play</h1>
        <button class="login-btn" tabindex="1" onclick="login()">התחברות עם Google</button>
    </div>

    <div id="profile-screen" style="display:none; position:fixed; inset:0; background:#000; flex-direction:column; align-items:center; justify-content:center; z-index:9000;">
        <h1>מי צופה?</h1><div id="profile-list" style="display:flex; gap:20px;"></div>
    </div>

    <div class="sidebar" id="sidebar" style="display:none;">
        <div class="logo"></div><div id="dynamic-nav"></div>
    </div>
    
    <div class="main-content" id="app" style="display:none;">
        <div class="top-section">
            <div id="hero-bg" class="hero-bg"></div>
            <div style="position:absolute; bottom:20px; right:50px; z-index:2;">
                <h1 id="hero-title" style="font-size:60px; margin:0;"></h1>
                <p id="hero-desc" style="font-size:20px; color:#ddd;"></p>
            </div>
        </div>
        <div class="bottom-section" id="home-view"></div>
        <div id="content-view" style="display:none; position:absolute; inset:0; background:#000; padding:40px; overflow-y:auto; z-index:20;"></div>
    </div>

    <div id="video-container"></div>

    <script src="data.js"></script>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyAuJlFyTuYypCVdJrZCrQGOEZZS5WDH6pI", authDomain: "app-c71dd.firebaseapp.com", projectId: "app-c71dd", storageBucket: "app-c71dd.firebasestorage.app", messagingSenderId: "256556501971", appId: "1:256556501971:web:98dbba775b0b8ca913bd26" };
        firebase.initializeApp(firebaseConfig);

        firebase.auth().onAuthStateChanged(user => {
            document.getElementById('loading-screen').style.display = 'none';
            if (user && user.email === "nitaylayish298@gmail.com") {
                showScreen('profiles'); loadProfiles();
            } else {
                showScreen('auth');
            }
        });

        function login() { firebase.auth().signInWithRedirect(new firebase.auth.GoogleAuthProvider()); }

        window.addEventListener('keydown', e => {
            const active = document.activeElement;
            if (e.key === 'Enter') {
                if (active.classList.contains('login-btn') || active.classList.contains('card') || active.classList.contains('nav-item') || active.classList.contains('profile-box')) {
                    active.click();
                }
            }
            if (e.key === 'ArrowRight' && active.classList.contains('card')) { e.preventDefault(); (active.previousElementSibling || document.querySelector('.nav-item')).focus(); }
            if (e.key === 'ArrowLeft' && active.classList.contains('card')) { e.preventDefault(); if(active.nextElementSibling) active.nextElementSibling.focus(); }
        });

        function loadProfiles() {
            const pData = [{n:'ניתאי', i:'https://img.freepik.com/free-psd/3d-illustration-person-with-sunglasses_23-2149436188.jpg'}];
            document.getElementById('profile-list').innerHTML = pData.map(p => `
                <div class="profile-box" tabindex="0" onclick="selectProfile('${p.n}')" style="text-align:center;">
                    <div style="width:120px; height:120px; border-radius:50%; background:url('${p.i}') center/cover; margin-bottom:10px; border:3px solid transparent;"></div>
                    <span>${p.n}</span>
                </div>`).join('');
            setTimeout(() => document.querySelector('.profile-box').focus(), 500);
        }

        function selectProfile(n) { showScreen('home'); renderHome(); }

        function renderHome() {
            const h = document.getElementById('home-view'); h.innerHTML = '';
            const items = seriesData;
            h.innerHTML = `<div class="category-block" style="padding:20px 50px;"><div class="row" style="display:flex; gap:15px; overflow-x:auto;">
                ${items.map(s => `<div class="card" tabindex="0" onclick="playHD('${s.driveId}')" style="width:200px; height:112px;"><img src="${s.image}"></div>`).join('')}
            </div></div>`;
            setTimeout(() => document.querySelector('.card').focus(), 100);
        }

        function playHD(id) {
            currentPlayingId = id;
            if (typeof AndroidControl !== 'undefined') AndroidControl.setVideoMode(true);
            
            // --- Loading ל-7 שניות ---
            const loader = document.getElementById('loader-overlay');
            loader.style.display = 'flex';
            setTimeout(() => { loader.style.display = 'none'; }, 7000); 

            document.getElementById('video-container').style.display = 'block';
            document.getElementById('video-container').innerHTML = `<iframe src="https://drive.google.com/file/d/${id}/preview" allowfullscreen style="width:100%; height:100%; border:none;"></iframe>`;
            
            if (typeof AndroidControl !== 'undefined') automateDrive();
        }

        // --- אוטומציה מותאמת לסטרימר איטי ---
        function automateDrive() {
            if(window.AndroidControl) {
                // במקום ללחוץ אחרי 1.5 שניות, אנחנו מחכים 5 שניות שהסטרימר יטען את הוידאו
                // ואז נותנים לחיצה אחת בודדת.
                setTimeout(function() { 
                    AndroidControl.triggerCenterClick(); 
                }, 5000); 
            }
        }

        function showScreen(s) {
            document.getElementById('auth-screen').style.display = (s==='auth'?'flex':'none');
            document.getElementById('profile-screen').style.display = (s==='profiles'?'flex':'none');
            document.getElementById('sidebar').style.display = (s==='home'?'flex':'none');
            document.getElementById('app').style.display = (s==='home'?'flex':'none');
        }

        window.handleBackPress = function() {
            if(document.getElementById('video-container').style.display === 'block') {
                document.getElementById('video-container').innerHTML = '';
                document.getElementById('video-container').style.display = 'none';
                document.getElementById('loader-overlay').style.display = 'none';
                window.hpDone = false;
                if (typeof AndroidControl !== 'undefined') AndroidControl.setVideoMode(false);
                return;
            }
            if(window.AndroidControl) AndroidControl.exitApp();
        };
    </script>
</body>
</html>
